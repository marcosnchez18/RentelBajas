<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen del Cliente</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { background-color: #f4f6f9; font-family: Arial, sans-serif; }
        .container { max-width: 900px; margin-top: 2rem; }
        h2 { color: #34495e; }
        .card { background-color: #ffffff; border: none; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 8px; margin-bottom: 1.5rem; padding: 1.5rem; }
        .form-group label { color: #7f8c8d; font-weight: bold; }
        .form-check-input { margin-right: 10px; }
        ul { list-style-type: none; padding-left: 0; }
        li { padding: 0.75rem 1rem; background-color: #ecf0f1; margin-bottom: 0.5rem; border-radius: 5px; color: #34495e; }
        .product-title { font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">Resumen del Cliente</h2>

        <!-- Información del Cliente -->
        <div id="clienteInfo" class="card">
            <form>
                <div class="form-group">
                    <label for="nombre">Nombre Completo:</label>
                    <input type="text" class="form-control" id="nombre" disabled>
                </div>
                <div class="form-group">
                    <label for="dni">DNI:</label>
                    <input type="text" class="form-control" id="dni" disabled>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email" disabled>
                </div>
                <div class="form-group">
                    <label for="telefonofijo">Teléfono Fijo:</label>
                    <input type="text" class="form-control" id="telefonofijo" disabled>
                </div>
                <div class="form-group">
                    <label for="telefonomovil">Teléfono Móvil:</label>
                    <input type="text" class="form-control" id="telefonomovil" disabled>
                </div>
                <div class="form-group">
                    <label for="direccion">Dirección:</label>
                    <input type="text" class="form-control" id="direccion" disabled>
                </div>
            </form>
        </div>

        <!-- Productos del Cliente -->
        <div id="cuentasResumen"></div>
        <div class="text-center"><button class="btn btn-success" onclick="confirmarBaja()">Confirmar</button></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const cuentaID = urlParams.get('id');

        // Cargar información del cliente desde localStorage
        const clienteSeleccionado = JSON.parse(localStorage.getItem('clienteSeleccionado'));

        if (clienteSeleccionado) {
            document.getElementById("nombre").value = clienteSeleccionado.nombre;
            document.getElementById("dni").value = clienteSeleccionado.dni;
            document.getElementById("email").value = clienteSeleccionado.email || "No disponible";
            document.getElementById("telefonofijo").value = clienteSeleccionado.telefonofijo;
            document.getElementById("telefonomovil").value = clienteSeleccionado.telefonomovil;
            document.getElementById("direccion").value = `${clienteSeleccionado.direccion}, ${clienteSeleccionado.poblacion}, ${clienteSeleccionado.codpostal}`;
        } else {
            document.getElementById("clienteInfo").innerHTML = "<p>Error: Cliente no encontrado.</p>";
        }

        // Obtener los productos del cliente por ID específico de cuenta
        async function obtenerProductos(id) {
            try {
                const response = await fetch(`http://10.58.6.89:8082/cliente/${id}/products`);
                const productos = await response.json();
                let productosHTML = "";

                if (productos.lineas_moviles && Object.keys(productos.lineas_moviles).length > 0) {
                    productosHTML += `<h4>Líneas Móviles</h4><ul>`;
                    Object.values(productos.lineas_moviles).forEach(linea => {
                        productosHTML += `<li><input type="checkbox" class="form-check-input"> 
                            <span class="product-title">Número:</span> ${linea.DDI}, 
                            <span class="product-title">Tarifa:</span> ${linea.NomTarifa}, 
                            <span class="product-title">Precio:</span> ${linea.PvpCuotaTarifa}€
                        </li>`;
                    });
                    productosHTML += `</ul>`;
                }

                if (productos.servicios_adicionales && Object.keys(productos.servicios_adicionales).length > 0) {
                    productosHTML += `<h4>Servicios Adicionales</h4><ul>`;
                    Object.values(productos.servicios_adicionales).forEach(servicio => {
                        productosHTML += `<li><input type="checkbox" class="form-check-input"> 
                            <span class="product-title">Descripción:</span> ${servicio.Descripcion}, 
                            <span class="product-title">Precio:</span> ${servicio.Precio}€
                        </li>`;
                    });
                    productosHTML += `</ul>`;
                }

                document.getElementById("cuentasResumen").innerHTML = productosHTML || "<p>No hay productos contratados.</p>";
            } catch (error) {
                console.error("Error al obtener productos:", error);
            }
        }

        obtenerProductos(cuentaID);
    </script>
</body>
</html>
