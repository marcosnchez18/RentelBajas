<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Cliente</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <!-- Barra de navegación superior -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <img src="../img/logo.png" alt="Logo" style="width: 50px;">
        </a>
        <div class="ml-auto">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="search.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Sobre nosotros</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contacto</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h2 class="mt-5">Detalles del Cliente</h2>

        <form id="clienteForm">
            <div class="form-group">
                <label for="dni">DNI</label>
                <input type="text" class="form-control" id="dni" name="dni">
            </div>

            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" name="nombre" disabled>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email">
            </div>

            <div class="form-group">
                <label for="telefonofijo">Teléfono Fijo</label>
                <input type="text" class="form-control" id="telefonofijo" name="telefonofijo" disabled>
            </div>

            <div class="form-group">
                <label for="telefonomovil">Teléfono Móvil</label>
                <input type="text" class="form-control" id="telefonomovil" name="telefonomovil" disabled>
            </div>

            <div class="form-group">
                <label for="direccion">Dirección</label>
                <input type="text" class="form-control" id="direccion" name="direccion" disabled>
            </div>

            <br /><br />
            <h4>Productos a dar de baja:</h4>
            <div class="form-group" id="productosContratados"></div>

            <!-- Botón de Confirmar -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success">Confirmar</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const dni = urlParams.get("dni");

            const dniField = document.getElementById("dni");
            const productosContainer = document.getElementById("productosContratados");

            if (dni) {
                fetch(`http://10.58.6.89:8082/get_data_client_baja_for_dni`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ dni: dni })
                })
                    .then(response => response.json())
                    .then(data => {
                        const cliente = data[0]; // Asumiendo que obtenemos el primer cliente

                        // Si el DNI es nulo o está vacío, lo hacemos editable, de lo contrario, lo deshabilitamos
                        if (cliente.dni) {
                            dniField.value = cliente.dni;
                            dniField.disabled = true;
                        } else {
                            dniField.value = '';
                            dniField.disabled = false;
                        }

                        document.getElementById("nombre").value = cliente.nombre;
                        document.getElementById("email").value = cliente.email;
                        document.getElementById("telefonofijo").value = cliente.telefonofijo;
                        document.getElementById("telefonomovil").value = cliente.telefonomovil;
                        document.getElementById("direccion").value = `${cliente.direccion}, ${cliente.poblacion}, ${cliente.codpostal}`;

                        // Mostrar solo los productos contratados
                        let productos = '';

                        if (cliente.Pfibra) {
                            productos += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fibra" checked>
                                    <label class="form-check-label" for="fibra">Fibra</label>
                                </div>`;
                        }

                        if (cliente.PMovil) {
                            productos += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="internet" checked>
                                    <label class="form-check-label" for="internet">Internet</label>
                                </div>`;
                        }

                        if (cliente.Pfijo) {
                            productos += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fijo" checked>
                                    <label class="form-check-label" for="fijo">Teléfono Fijo</label>
                                </div>`;
                        }

                        if (cliente.Pcentralita) {
                            productos += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="centralita" checked>
                                    <label class="form-check-label" for="centralita">Centralita</label>
                                </div>`;
                        }

                        if (cliente.Ptv) {
                            productos += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="television" checked>
                                    <label class="form-check-label" for="television">Televisión</label>
                                </div>`;
                        }

                        // Si no hay productos contratados
                        if (productos === '') {
                            productos = '<p>El cliente no tiene productos contratados.</p>';
                        }

                        productosContainer.innerHTML = productos;
                    })
                    .catch(error => console.error("Error al cargar los datos del cliente:", error));
            }
        });
    </script>
</body>

</html>
